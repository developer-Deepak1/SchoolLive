<p-toast></p-toast>
<div class="flex flex-wrap items-center gap-3 mb-1">
  <button pButton pRipple type="button" label="Back" icon="pi pi-arrow-left" class="p-button-text" (click)="back()"></button>
</div>
<h2 class="page-title">Employee Profile</h2>

<ng-container *ngIf="!loading()">
  <ng-container *ngIf="employee(); else notFoundTpl">
    <div class="profile-wrapper">
      <p-card class="profile-hero">
        <div class="hero-grid">
          <div class="hero-avatar">
            <p-avatar *ngIf="displayName(); else fallbackIcon" [label]="initials(displayName())" size="xlarge" shape="circle" styleClass="surface-0 text-primary font-semibold text-lg shadow-2" ></p-avatar>
            <ng-template #fallbackIcon>
              <p-avatar icon="pi pi-user" size="xlarge" shape="circle" styleClass="shadow-2" />
            </ng-template>
          </div>
          <div class="hero-main">
            <div class="hero-name">{{displayName()}}</div>
            <div class="hero-meta flex gap-2 mt-2 items-center">
              <p-tag *ngIf="employee()!.Status" [severity]="statusSeverity(employee()!.Status)" [value]="employee()!.Status"></p-tag>
              <p-tag *ngIf="employee()!.RoleName" severity="info" [value]="employee()!.RoleName"></p-tag>
            </div>
          </div>
          <div class="hero-actions">
            <button pButton pRipple icon="pi pi-pencil" label="Edit" (click)="edit()"></button>
          </div>
        </div>
      </p-card>

      <div class="grid info-grid three">
        <p-card header="Identity" class="panel">
          <div class="kv">
            <div class="row"><span>Username</span><strong>{{employee()!.Username || '-'}}</strong></div>
            <div class="row"><span>Name</span><strong>{{displayName() || '-'}}</strong></div>
            <div class="row"><span>Gender</span><strong>{{employee()!.Gender || '-'}}</strong></div>
            <div class="row"><span>DOB</span><strong>{{employee()!.DOB ? (employee()!.DOB | date:'dd-MMM-yyyy') : '-'}}</strong></div>
          </div>
        </p-card>

        <p-card header="Employment" class="panel">
          <div class="kv">
            <div class="row"><span>Role</span><strong>{{employee()!.RoleName || '-'}}</strong></div>
            <div class="row"><span>Joining</span><strong>{{employee()!.JoiningDate ? (employee()!.JoiningDate | date:'dd-MMM-yyyy') : '-'}}</strong></div>
            <div class="row"><span>Salary</span><strong>{{employee()!.Salary ? (employee()!.Salary | currency:'INR':'symbol') : '-'}}</strong></div>
            <div class="row"><span>Status</span><strong>{{employee()!.Status || '-'}}</strong></div>
          </div>
        </p-card>

        <p-card header="Contact" class="panel">
          <div class="kv">
            <div class="row"><span>Contact</span><strong>{{employee()!.ContactNumber || '-'}}</strong></div>
            <div class="row"><span>Email</span><strong>{{employee()!.EmailID || '-'}}</strong></div>
          </div>
        </p-card>
      </div>
      <div class="attendance-row">
        <p-card header="Monthly Attendance Report">
          <div class="chart-wrapper">
            <canvas baseChart
              [data]="attendanceLineData"
              [options]="attendanceLineOptions"
              type="line"></canvas>
          </div>
        </p-card>
      </div>
    </div>
  </ng-container>
</ng-container>

<ng-template #notFoundTpl>
  <p-card>
    <div class="p-4">Employee not found.</div>
  </p-card>
</ng-template>

<ng-template #skeletonTpl>
  <div class="grid md:grid-cols-3 gap-4">
    <p-card *ngFor="let i of [0,1,2,3]">
      <div class="flex flex-col gap-2">
        <p-skeleton width="60%" height="1.2rem"></p-skeleton>
        <p-skeleton width="80%" height="0.9rem"></p-skeleton>
        <p-skeleton width="50%" height="0.9rem"></p-skeleton>
        <p-skeleton width="70%" height="0.9rem"></p-skeleton>
      </div>
    </p-card>
  </div>
</ng-template>
