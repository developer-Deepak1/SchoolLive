<p-toast></p-toast>

<!-- Search Card -->
<p-card header="Search" styleClass="w-full mb-4">
	<div class="search-grid">
		<div class="student-picker">
			<label for="student" class="block mb-1">Search Student Name</label>
			<p-autocomplete inputId="student" [(ngModel)]="studentInput" name="student"
				[suggestions]="studentSuggestions" (completeMethod)="searchStudents($event)"
				(onSelect)="onStudentSelected($event)" (onClear)="onStudentCleared()" field="StudentName"
				placeholder="Search student by name, class or section" [dropdown]="true" [forceSelection]="true"
				[optionLabel]="'StudentName'"
				styleClass="w-full md:w-24rem lg:w-28rem xl:w-32rem">
				<ng-template let-s pTemplate="item">
					<div class="ac-item">
						<div class="name">{{ s.StudentName }}</div>
						<div class="sub muted">Class: {{ s.ClassName || '-' }} â€¢ Section: {{ s.SectionName || '-' }}</div>
					</div>
				</ng-template>
				<ng-template let-s pTemplate="selectedItem">
					{{ s?.StudentName || '' }}
					<span *ngIf="s?.ClassName as c"> ({{ c }}-{{ s?.SectionName || '-' }})</span>
				</ng-template>
			</p-autocomplete>
		</div>
	</div>
</p-card>

<!-- Monthly Paid -->
<p-card header="Monthly Fees (Paid)" styleClass="w-full mb-4">
	<p-table [value]="monthlyPaid()" [loading]="loading" dataKey="StudentFeeID" [paginator]="true" [rows]="10"
		[responsiveLayout]="'scroll'" [tableStyle]="{'min-width':'50rem'}">
		<ng-template pTemplate="header">
			<tr>
				<th>Fee</th>
					<th class="text-right">Amount</th>
					<th class="text-right">Fine</th>
					<th class="text-right">Discount</th>
				<th class="text-right">Paid</th>
				<th>Due Date</th>
				<th>Status</th>
			</tr>
		</ng-template>
		<ng-template pTemplate="body" let-row>
			<tr>
				<td>
					<div class="fee-name">{{ row.FeeName }} <span class="muted small" *ngIf="row.DueDate">- {{ row.DueDate | date:'MMMM yyyy' }}</span></div>
					<div class="muted small" *ngIf="row.InvoiceRef">Ref: {{ row.InvoiceRef }}</div>
				</td>
					<td class="text-right">{{ row.Amount | number:'1.2-2' }}</td>
					<td class="text-right">{{ (row.ComputedFine ?? row.FineAmount) | number:'1.2-2' }}</td>
					<td class="text-right">{{ row.DiscountAmount | number:'1.2-2' }}</td>
				<td class="text-right strong">{{ row.AmountPaid | number:'1.2-2' }}</td>
				<td>{{ row.DueDate || '-' }}</td>
				<td><span>{{ row.Status }}</span></td>
			</tr>
		</ng-template>
    
	</p-table>
	<div class="muted" *ngIf="!loading && !monthlyPaid().length">No monthly paid records.</div>
  
</p-card>

<!-- OnDemand Paid -->
<p-card header="On-Demand Fees (Paid)" styleClass="w-full mb-4">
	<p-table [value]="onDemandPaid()" [loading]="loading" dataKey="StudentFeeID" [paginator]="true" [rows]="10"
		[responsiveLayout]="'scroll'" [tableStyle]="{'min-width':'50rem'}">
		<ng-template pTemplate="header">
			<tr>
				<th>Fee</th>
					<th class="text-right">Amount</th>
					<th class="text-right">Fine</th>
					<th class="text-right">Discount</th>
				<th class="text-right">Paid</th>
				<th>Due Date</th>
				<th>Status</th>
			</tr>
		</ng-template>
		<ng-template pTemplate="body" let-row>
			<tr>
				<td>
					<div class="fee-name">{{ row.FeeName }}</div>
					<div class="muted small" *ngIf="row.InvoiceRef">Ref: {{ row.InvoiceRef }}</div>
				</td>
					<td class="text-right">{{ row.Amount | number:'1.2-2' }}</td>
					<td class="text-right">{{ (row.ComputedFine ?? row.FineAmount) | number:'1.2-2' }}</td>
					<td class="text-right">{{ row.DiscountAmount | number:'1.2-2' }}</td>
				<td class="text-right strong">{{ row.AmountPaid | number:'1.2-2' }}</td>
				<td>{{ row.DueDate || '-' }}</td>
				<td><span>{{ row.Status }}</span></td>
			</tr>
		</ng-template>
    
	</p-table>
	<div class="muted" *ngIf="!loading && !onDemandPaid().length">No on-demand paid records.</div>
</p-card>

<!-- OneTime Paid -->
<p-card header="One-Time Fees (Paid)" styleClass="w-full mb-4">
	<p-table [value]="oneTimePaid()" [loading]="loading" dataKey="StudentFeeID" [paginator]="true" [rows]="10"
		[responsiveLayout]="'scroll'" [tableStyle]="{'min-width':'50rem'}">
		<ng-template pTemplate="header">
			<tr>
				<th>Fee</th>
					<th class="text-right">Amount</th>
					<th class="text-right">Fine</th>
					<th class="text-right">Discount</th>
				<th class="text-right">Paid</th>
				<th>Due Date</th>
				<th>Status</th>
			</tr>
		</ng-template>
		<ng-template pTemplate="body" let-row>
			<tr>
				<td>
					<div class="fee-name">{{ row.FeeName }}</div>
					<div class="muted small" *ngIf="row.InvoiceRef">Ref: {{ row.InvoiceRef }}</div>
				</td>
					<td class="text-right">{{ row.Amount | number:'1.2-2' }}</td>
					<td class="text-right">{{ (row.ComputedFine ?? row.FineAmount) | number:'1.2-2' }}</td>
					<td class="text-right">{{ row.DiscountAmount | number:'1.2-2' }}</td>
				<td class="text-right strong">{{ row.AmountPaid | number:'1.2-2' }}</td>
				<td>{{ row.DueDate || '-' }}</td>
				<td><span>{{ row.Status }}</span></td>
			</tr>
		</ng-template>
    
	</p-table>
	<div class="muted" *ngIf="!loading && !oneTimePaid().length">No one-time paid records.</div>
</p-card>
