<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
	<!-- Card 1: Fine Policy Form -->
	<div #formCard class="form-card-wrapper">
	<p-card header="{{ editingId ? 'Edit Fine Policy' : 'Create Fine Policy' }}" styleClass="w-full">
			<form class="form-grid" (ngSubmit)="save()">
				<div class="form-row">
				<label for="fee">Apply To Fee</label>
				<p-select inputId="fee" [options]="feeOptions" optionLabel="label" optionValue="value" [(ngModel)]="form.FeeID" name="FeeID" placeholder="All Fees" [showClear]="true" styleClass="w-full"></p-select>
			</div>
			<div class="form-row">
				<label for="type">Apply Type</label>
				<p-select
					inputId="type"
					[options]="applyTypeOptions"
					optionLabel="label"
					optionValue="value"
					[(ngModel)]="form.ApplyType"
					(ngModelChange)="onApplyTypeChange($event)"
					name="ApplyType"
					styleClass="w-full"
				></p-select>
			</div>
			<div class="form-row">
				<label for="amount">{{ amountLabel(form.ApplyType) }}</label>
				<ng-container *ngIf="form.ApplyType === 'Percentage'; else amountNormal">
					<p-inputNumber
						inputId="amount"
						[(ngModel)]="form.Amount"
						name="Amount"
						[min]="0"
						[max]="100"
						[mode]="'decimal'"
						[showButtons]="true"
						[suffix]="' ' + amountSuffix(form.ApplyType)"
					></p-inputNumber>
				</ng-container>
				<ng-template #amountNormal>
					<p-inputNumber
						inputId="amount"
						[(ngModel)]="form.Amount"
						name="Amount"
						[min]="0"
						[mode]="'decimal'"
						[showButtons]="true"
						[suffix]="' ' + amountSuffix(form.ApplyType)"
					></p-inputNumber>
				</ng-template>
			</div>
			<div class="form-row">
				<label for="grace">Grace Days</label>
				<p-inputNumber inputId="grace" [(ngModel)]="form.GraceDays" name="GraceDays" [min]="0" [showButtons]="true"></p-inputNumber>
			</div>
			<div class="form-row">
				<label for="max">Max Amount (cap)</label>
				<p-inputNumber inputId="max" [(ngModel)]="form.MaxAmount" name="MaxAmount" [min]="0" [mode]="'decimal'" [showButtons]="true"></p-inputNumber>
			</div>
			<!-- Active toggle removed from form as requested -->

					<div class="form-actions-left">
				<button pButton type="button" label="Reset" class="p-button-text" (click)="openNew()"></button>
					<button pButton type="submit" [label]="editingId ? 'Update' : 'Save'" [loading]="saving"></button>
			</div>
		</form>
	</p-card>
	</div>
	<div style="height: 20px;"></div>
	<!-- Card 2: Policies List -->
	<p-card header="Fine Policies"  styleClass="w-full">
		<p-table [value]="policies" 
		[loading]="loading" 
		dataKey="FinePolicyID" 
		[paginator]="true" 
		[rows]="10" 
		[tableStyle]="{'min-width':'50rem'}">
			<ng-template pTemplate="header">
				<tr>
					<th class="sticky-col" style="width:2rem">#</th>
					<th style="width:8rem">Fee</th>
					<th>Apply Type</th>
					<th>Amount</th>
					<th>Grace Days</th>
					<th>Max Cap</th>
					<th style="width:12rem">Actions</th>
				</tr>
			</ng-template>
			<ng-template pTemplate="body" let-row let-i="rowIndex">
				<tr>
					<td data-label="#" class="sticky-col">{{ i + 1 }}</td>
					<td data-label="Fee">
						{{ feeLabel(row.FeeID) }}
					</td>
					<td data-label="Type">
						{{ row.ApplyType || '-' }}
					</td>
					<td data-label="Amount">
						{{ row.Amount }}<span class="muted">{{ amountSuffix(row.ApplyType) }}</span>
					</td>
					<td data-label="Grace Days">
						{{ row.GraceDays }}
					</td>
					<td data-label="Max Cap">
						{{ row.MaxAmount ?? '-' }}
					</td>
					<td>
						<div class="flex items-center gap-2">
							<button pButton type="button" icon="pi pi-pencil" (click)="edit(row)" class="p-button-text p-button-sm" aria-label="Edit"></button>
							<button pButton type="button" icon="pi pi-trash" (click)="remove(row)" class="p-button-text p-button-danger p-button-sm" aria-label="Delete"></button>
						</div>
					</td>
				</tr>
			</ng-template>
				<ng-template pTemplate="emptymessage">
					<tr>
						<td colspan="7">No fine policies configured.</td>
					</tr>
				</ng-template>
		</p-table>
	</p-card>
