<div class="mb-6 p-4 rounded-md bg-white">
	<h5 class="mt-0 mb-4 font-semibold">Classwise Attendance</h5>
	<div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-start mb-4">
		<div>
			<label class="block font-bold mb-2">Class</label>
			<p-select inputId="classSelect" [(ngModel)]="selectedClass" [options]="classOptions" optionLabel="ClassName" optionValue="ClassID" placeholder="Select Class" class="w-full" (onChange)="onClassChange()"></p-select>
		</div>
		<div>
			<label class="block font-bold mb-2">Section</label>
			<p-select inputId="sectionSelect" [(ngModel)]="selectedSection" [options]="sectionOptions" optionLabel="SectionName" optionValue="SectionID" placeholder="Select Section" class="w-full" [disabled]="!selectedClass" (onChange)="onSectionChange()"></p-select>
		</div>

		<div>
			<label class="block font-bold mb-2">Month</label>
			<p-datepicker [(ngModel)]="date" view="month" dateFormat="mm/yy" (onSelect)="updateGrid()" [showButtonBar]="true" class="w-full"></p-datepicker>
		</div>

		<div class="flex items-end">
			<div class="flex gap-2">
				<p-button label="Load" icon="pi pi-refresh" (onClick)="updateGrid()" [disabled]="!selectedClass || !selectedSection"></p-button>
				<p-button label="Export" icon="pi pi-download" severity="secondary"></p-button>
			</div>
		</div>
	</div>
    <div>
		
	</div>
	<!-- Desktop: existing p-table kept -->
	<p-table
		[value]="filteredRows"
		[paginator]="true"
		[rows]="20"
		dataKey="studentName"
		[tableStyle]="{ 'min-width': '60rem' }"
		[scrollable]="true"
		>

		<ng-template pTemplate="caption">
			<div class="flex items-center justify-between">
				<h5 class="m-0">Attendance for {{ selectedClassLabel }}{{ selectedSectionLabel ? ' — ' + selectedSectionLabel : '' }} ({{ date | date:'MMMM yyyy' }})</h5>
				<div class="ml-4">
					<input type="text" placeholder="Search student" class="p-inputtext p-component p-inputtext-sm" [(ngModel)]="filterText" />
				</div>
			</div>
		</ng-template>

		<ng-template pTemplate="header">
			<tr>
				<th style="position:sticky; left:0; background:#fff; z-index:3; width:48px; text-align:center;">#</th>
				<th>Student Name</th>
				<th *ngFor="let d of days">{{d}}</th>
				<th>Total Present</th>
				<th>Total Absent</th>
			</tr>
		</ng-template>

		<ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
			<tr>
				<td style="position:sticky; left:0; background:#fff; z-index:3; width:48px; text-align:center;">{{ rowIndex + 1 }}</td>
				<td>
					<div class="student-name-scroll" title="{{rowData.studentName}}">{{rowData.studentName}}</div>
				</td>
				<td *ngFor="let s of rowData.statuses" class="p-2" style="text-align:center;">
					<p-tag [value]="s.toUpperCase()" [severity]="getSeverity(s)"></p-tag>
				</td>
				<td style="text-align:center; font-weight:600;">{{ getPresentCount(rowData) }}</td>
				<td style="text-align:center; font-weight:600;">{{ getAbsentCount(rowData) }}</td>
			</tr>
		</ng-template>
		<ng-template pTemplate="caption">
			<div class="mt-2 flex gap-2 items-center">
				<p-tag [value]="'P'" [severity]="getSeverity('p')"></p-tag><span>Present</span>
				<p-tag [value]="'L'" [severity]="getSeverity('l')"></p-tag><span>Leave</span>
				<p-tag [value]="'H'" [severity]="getSeverity('h')"></p-tag><span>Half Day</span>
				<p-tag [value]="'A'" [severity]="getSeverity('a')"></p-tag><span>Absent</span>
				<p-tag [value]="'-'" [severity]="getSeverity('-')"></p-tag><span>No Status</span>
				<p-tag [value]="'*'" [severity]="getSeverity('*')"></p-tag><span>Holiday</span>
			</div>
		</ng-template>

	</p-table>

	<!-- mobile view removed -->

	<!-- Detail dialog (show full day-by-day matrix for the selected student) -->
	<p-dialog header="{{selected?.studentName}} — Details" [(visible)]="detailDialogVisible" [modal]="true" [style]="{width: '95vw', maxWidth: '720px'}">
		<div class="overflow-auto">
			<table class="min-w-full">
				<thead><tr><th *ngFor="let d of days">{{d}}</th></tr></thead>
				<tbody><tr><td *ngFor="let s of (selected?.statuses || [])" class="text-center"><p-tag [value]="s.toUpperCase()" [severity]="getSeverity(s)"></p-tag></td></tr></tbody>
			</table>
		</div>
	</p-dialog>
</div>
