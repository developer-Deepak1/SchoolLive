<p-toast></p-toast>
<div class="attendance-page">
    <p-card class="mb-3">
        <p-toolbar>
            <div class="p-toolbar-group-left">
                <h3 class="m-0">Student Attendance</h3>
            </div>
            <div class="p-toolbar-group-right">
                <p-select [options]="classOptions" optionLabel="ClassName" optionValue="ClassID" [(ngModel)]="selectedClass" placeholder="Class" (onChange)="onClassChange()" class="mr-2"></p-select>
                <p-select [options]="sectionOptions" optionLabel="SectionName" optionValue="SectionID" [(ngModel)]="selectedSection" placeholder="Section" class="mr-2"></p-select>
                <p-datepicker [(ngModel)]="dateModel" dateFormat="yy-mm-dd" inputId="attDate" class="mr-2"></p-datepicker>
                <p-button label="Search" icon="pi pi-search" (onClick)="search()" class="p-button-outlined mr-2"></p-button>
                <p-tag *ngIf="attendanceTaken()" severity="warning" value="Attendance taken"></p-tag>
                <p-button label="Reload" icon="pi pi-refresh" class="p-button-text mr-2" (onClick)="load()" [disabled]="loading()||saving()"></p-button>
                <p-button label="Save Changes" icon="pi pi-save" (onClick)="save()" [disabled]="saving() || dirtyRows.length===0"></p-button>
            </div>
        </p-toolbar>
    </p-card>

    <p-table [value]="rows()" dataKey="StudentID" [loading]="loading()" [tableStyle]="{'min-width':'70rem'}" [rows]="25" [paginator]="true" [rowsPerPageOptions]="[25,50,100]">
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem">#</th>
                <th>Student</th>
                <th>Class</th>
                <th>Section</th>
                <th style="width: 10rem">Status</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-row let-i="rowIndex">
            <tr [class.dirty]="row._dirty">
                <td>{{ i+1 }}</td>
                <td>{{ row.StudentName }}</td>
                <td>{{ row.ClassName }}</td>
                <td>{{ row.SectionName }}</td>
                <td>
                    <p-selectButton [options]="statuses" optionLabel="label" optionValue="value" [(ngModel)]="row.Status" (ngModelChange)="markChanged(row)"></p-selectButton>
                </td>
            </tr>
        </ng-template>
    </p-table>

    <div class="legend">
        <span><strong>P</strong> Present</span>
        <span><strong>L</strong> Leave</span>
        <span><strong>H</strong> Half Day</span>
        <span><strong>A</strong> Absent</span>
        <span class="ml-auto" *ngIf="dirtyRows.length>0">{{ dirtyRows.length }} change(s) pending</span>
    </div>
</div>
