<div class="mb-6 p-4 rounded-md bg-white">
  <h5 class="mt-0 mb-4 font-semibold">{{ editing ? 'Edit Academic Year' : 'Add Academic Year' }}</h5>
  <form [formGroup]="yearForm" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-start">
    <div>
      <label for="AcademicYearName" class="block font-bold mb-2">Year Name *</label>
      <input type="text" pInputText id="AcademicYearName" formControlName="AcademicYearName" class="w-full" />
      <div class="h-5 mt-1">
        <small class="text-red-500" *ngIf="isFieldInvalid('AcademicYearName')">Required</small>
      </div>
    </div>
    <div>
      <label for="StartDate" class="block font-bold mb-2">Start Date *</label>
      <p-datepicker id="StartDate" formControlName="StartDate" dateFormat="yy-mm-dd" [showIcon]="true" [timeOnly]="false" [showTime]="false" class="w-full"></p-datepicker>
      <div class="h-5 mt-1">
        <small class="text-red-500" *ngIf="isFieldInvalid('StartDate')">Required</small>
      </div>
    </div>
    <div>
      <label for="EndDate" class="block font-bold mb-2">
        End Date *
        <span class="text-sm font-normal text-gray-500" *ngIf="isEndDateDisabled">(Select Start Date first)</span>
      </label>
      <p-datepicker id="EndDate" formControlName="EndDate" dateFormat="yy-mm-dd" [showIcon]="true" [minDate]="startDateValue" [timeOnly]="false" [showTime]="false" [disabled]="isEndDateDisabled" class="w-full"></p-datepicker>
      <div class="h-5 mt-1">
        <small class="text-red-500" *ngIf="isFieldInvalid('EndDate') && !isEndDateDisabled">Required</small>
        <small class="text-gray-500" *ngIf="isEndDateDisabled">Please select a start date first</small>
      </div>
    </div>
    <div>
      <label for="Status" class="block font-bold mb-2">
        Status *
        <span class="text-sm font-normal text-gray-500" *ngIf="isStatusDisabled">(Cannot change Active status)</span>
      </label>
      <p-select id="Status" formControlName="Status" [options]="statusOptions" optionLabel="label" optionValue="value" placeholder="Select Status" class="w-full" [disabled]="isStatusDisabled"></p-select>
      <div class="h-5 mt-1">
        <small class="text-red-500" *ngIf="isFieldInvalid('Status')">Required</small>
      </div>
    </div>
    <!-- Buttons on their own second row spanning all columns -->
    
  </form>
  <div class="mt-4">
    <div class="flex justify-start gap-2">
      <p-button label="{{ editing ? 'Update' : 'Save' }}" icon="pi pi-check" (onClick)="saveYear()" />
      <p-button *ngIf="editing" label="Cancel" icon="pi pi-times" severity="secondary" (onClick)="cancelEdit()" />
      <p-button *ngIf="!editing" label="Reset" icon="pi pi-refresh" severity="secondary" (onClick)="openNew()" />
    </div>
  </div>
</div>

<p-table #dt
  [value]="years()"
  [rows]="10"
  [paginator]="true"
  [globalFilterFields]="['AcademicYearName','StartDate','EndDate','Status']"
  dataKey="AcademicYearID"
  [tableStyle]="{ 'min-width': '60rem' }"
  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} academic years"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="[10,20,30]">

  <ng-template pTemplate="caption">
    <div class="flex items-center justify-between">
      <h5 class="m-0">Academic Year List</h5>
      <!-- <p-iconfield>
        <p-inputicon styleClass="pi pi-search" />
        <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Search..." />
      </p-iconfield> -->
    </div>
  </ng-template>

  <ng-template pTemplate="header">
    <tr>
      <th style="width: 1rem"></th>
      <th pSortableColumn="AcademicYearName" class="pl-4">Name <p-sortIcon field="AcademicYearName" /></th>
      <th pSortableColumn="StartDate">Start Date <p-sortIcon field="StartDate" /></th>
      <th pSortableColumn="EndDate">End Date <p-sortIcon field="EndDate" /></th>
      <th pSortableColumn="Status">Status <p-sortIcon field="Status" /></th>
      <th>Actions</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-year>
    <tr>
      <td></td>
      <td class="pl-4">{{year.AcademicYearName}}</td>
      <td>{{year.StartDate | date:'yyyy-MM-dd'}}</td>
      <td>{{year.EndDate   | date:'yyyy-MM-dd'}}</td>
      <td>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
              [ngClass]="{
                'bg-green-100 text-green-800': year.Status === 'Active',
                'bg-gray-100 text-gray-800': year.Status === 'Inactive',
                'bg-blue-100 text-blue-800': year.Status === 'Upcoming',
                'bg-red-100 text-red-800': year.Status === 'End'
              }">
          {{year.Status}}
        </span>
      </td>
      <td>
        <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true" (onClick)="editYear(year)" />
        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (onClick)="deleteYear(year)" />
      </td>
    </tr>
  </ng-template>

</p-table>

<p-confirmDialog [style]="{ width: '450px' }" />
<p-toast />